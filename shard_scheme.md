─────────────────────────────────────────────────────────────────────────────
                        СХЕМА ШАРДИРОВАНИЯ
─────────────────────────────────────────────────────────────────────────────

                           ┌─────────────────────────────┐
                           │        USERS DB             │
                           │  PostgreSQL (master + 2xrep)│
                           └─────────────────────────────┘
                                      ▲
                    ┌─────────────────┼────────────────┐
                    ▼                 ▼                ▼
               SELLERS           ADDRESSES        PAYMENT_METHODS
          PostgreSQL shard0     PostgreSQL        MongoDB (NoSQL)

─────────────────────────────────────────────────────────────────────────────

                         ШАРДИРУЕМЫЕ ДАННЫЕ ПО КЛЮЧАМ
─────────────────────────────────────────────────────────────────────────────

                         [ SHARD GROUP: ORDERS ]
             ┌────────────────────────────┐
             │      ORDER SHARDING        │
             └────────────────────────────┘
                       Shard Key: `user_id`
                       Strategy: Consistent Hashing
                       Storage: PostgreSQL (шардированная конфигурация)

                  ┌────────────┬────────────┬────────────┐
                  │ Shard-1    │ Shard-2    │ Shard-3    │
                  └────────────┴────────────┴────────────┘
                  │ Orders     │ Orders     │ Orders     │
                  │ OrderItems │ OrderItems │ OrderItems │
                  └────────────┴────────────┴────────────┘
                       ▲             ▲             ▲
                       │             │             │
                    2x Replicas   2x Replicas   2x Replicas

###  Нагрузка:

| Таблица         | Действие                         | RPS (×3 пиковая) | Тип нагрузки             |
|-----------------|----------------------------------|------------------|--------------------------|
| `orders`        | Покупка, оформление              | **777.138**      | 🔴 Высокая (Write-heavy) |
| `order_items`   | Формирование позиции заказа      | **777.138**      | 🔴 Высокая (Join-heavy)  |



─────────────────────────────────────────────────────────────────────────────

                        [ SHARD GROUP: SHIPMENTS ]
             ┌────────────────────────────┐
             │     SHIPMENT SHARDING      │
             └────────────────────────────┘
                     Shard Key: `order_id`
                     Strategy: Hash Partitioning
                     Storage: PostgreSQL (линейный шардинг)

                  ┌────────────┬────────────┬────────────┐
                  │ Shard-X    │ Shard-Y    │ Shard-Z    │
                  └────────────┴────────────┴────────────┘
                  │ Shipments  │ Shipments  │ Shipments  │
                  └────────────┴────────────┴────────────┘
                       ▲             ▲             ▲
                   2x Replicas    2x Replicas    2x Replicas

###  Нагрузка:

| Таблица        | Действие                    | RPS (×3 пиковая) | Тип нагрузки     |
|----------------|-----------------------------|------------------|------------------|
| `shipments`    | Отгрузка, логистика         | **61.11**        | 🔴 Write-heavy   |
|                | (логистика: 1.76M/day)      |                  |                  |

─────────────────────────────────────────────────────────────────────────────

                  [ SEARCH INDEX — АВТО ШАРДИРОВАНИЕ ]
           ┌──────────────────────────────────────────────┐
           │         Elasticsearch                        │
           │    Auto-sharding: 5 primary shards + replicas│
           │     Shard Key: internal hash by product_id   │
           └──────────────────────────────────────────────┘

### Нагрузка:

| Таблица           | Действие                   | RPS (×3 пиковая) | Тип нагрузки      |
|-------------------|----------------------------|------------------|-------------------|
| `search_index`    | Поиск, фильтрация, фасеты  | ~20–50K (оценка) | 🔴 Read-heavy      |
           

─────────────────────────────────────────────────────────────────────────────

                       Остальные таблицы без шардирования
─────────────────────────────────────────────────────────────────────────────

- Таблицы `categories`, `characteristics_product`, `reviews`, `products_with_categories`, `sessions`, `cart_items` (Redis), `search_index` (внешний сервис)
- Используют масштабирование за счёт кешей, индексов и реплик
- Обслуживаются одним экземпляром БД или кеша с возможностью горизонтального масштабирования
